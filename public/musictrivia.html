<!DOCTYPE html>
<html>
<head>
    <style>
        .song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .song-info, .song-buttons {
            display: flex;
            align-items: left;
        }
    </style>
    <title>Music Trivia</title>
    <script>
        let songs = []

        window.onload = function() {
            console.log('Page loading')
            fetch('/round')
            .then(response => response.json())
            .then(data => {
                let output = document.getElementById('output');
                data.forEach((song, index) => {
                    
                    songs.push(song)

                    let songElement = document.createElement('div');
                    songElement.className = 'song-item';
                    
                    // store the song data in the songElement
                    songElement.dataset.song = JSON.stringify(song)

                    let songInfo = document.createElement('div');
                    songInfo.className = 'song-info';
                    let textElement = document.createElement('p');
                    textElement.textContent = `${song.Artist} - ${song.Title} (${song.Ranking}) (${song["Year"]})`;
                    songInfo.appendChild(textElement);
                    songElement.appendChild(songInfo);

                    let songButtons = document.createElement('div');
                    songButtons.className = 'song-buttons';
                    
                    
                    let upButton = document.createElement('button');
                    upButton.textContent = 'Up';
                    upButton.onclick = function() {
                        // Get the previous sibling of the songElement
                        let previousElement = songElement.previousElementSibling;

                        // If there is a previous sibling, move the songElement before it
                        if (previousElement) {
                            songElement.parentNode.insertBefore(songElement, previousElement);
                        }
                    };
                    songButtons.appendChild(upButton);
                               
                    let downButton = document.createElement('button');
                    downButton.textContent = 'Down';
                    downButton.onclick = function() {
                        // Get the next sibling of the songElement
                        let nextElement = songElement.nextElementSibling;

                        // If there is a next sibling, move it before the songElement to effectively move the songElement down
                        if (nextElement) {
                            songElement.parentNode.insertBefore(nextElement, songElement);
                        }
                    };
                    songButtons.appendChild(downButton);

                    let replaceButton = document.createElement('button');
                    replaceButton.textContent = 'Replace';
                    replaceButton.onclick = function() {
                        console.log('replace clicked', song, JSON.stringify({ song: song }))
                        fetch(`/song?year=${encodeURIComponent(song["Year"])}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })
                        .then(response => response.json())
                        .then(newSong => {
                            console.log('Success:', newSong);
                            song = newSong; // Replace the old song with the new song in the data array
                            textElement.textContent = `${song.Artist} - ${song.Title} (${song.Ranking}) (${song["Year"]})`;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    };
                    songButtons.appendChild(replaceButton);
    
                    let neverplayButton = document.createElement('button');
                    neverplayButton.textContent = 'Never play';
                    neverplayButton.onclick = function() {
                        console.log('never play clicked', song, JSON.stringify({ song: song }))
                        fetch('/neverplay', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({id: song[""], year: song["Year"]}),
                        })
                        .then(response => response.json())
                        .then(data => {
                            let song = data.newSong
                            textElement.textContent = `${song.Artist} - ${song.Title} (${song.Ranking}) (${song["Year"]})`;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    };
                    songButtons.appendChild(neverplayButton);
                    
                    songElement.appendChild(songButtons);
                    output.appendChild(songElement);
                });
            })
                .catch(error => console.error(error));
        };
    </script>
</head>
<body>
    <h1>Music Trivia</h1>
    <div id="output"></div>
</body>
</html>